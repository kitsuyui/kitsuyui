# ダミーの Shared Library を作りたい

たくさんの共有ライブラリに依存している多機能なプログラムの場合、ある用途でははそのライブラリの機能を全く使う必要がないということがたまにある。
しかし、かといって共有ライブラリを削除してしまうと、依存しているので動作しなくなってしまう。

特に GUI を持っているが CUI でも動作するようなプログラムだと、 X11 や GTK に依存していると削りたくなる。

そういうとき、シンボルテーブルだけは同じにしたダミーの (モックの, 偽の, 空の) ライブラリを作れば動作することがある。


## やり方

この例では Linux 環境で /usr/lib/libgtk-3.so.0.2200.26 という共有ライブラリのダミーを作る。

```
objdump -T /usr/lib/libgtk-3.so.0.2200.26 -j .text | \
tail -n +5 | grep -v '^$' | awk '{print $6}' | \
awk '{print "void",$1,"(){}"}' | sort -n | uniq > a.c && \
gcc -fPIC -shared -o x.so -Wl,--soname='/usr/lib/libgtk-3.so.0.2200.26' a.c && \
mv x.so /usr/lib/libgtk-3.so.0.2200.26 && \
```

### やっていること

1. シンボルテーブルのシンボル名だけガッと抜き出す (objdump コマンドの 5 行くらいは要らないので消す)
2. `void name() {}` という空の関数定義を作ってやる
3. あとは普通にコンパイル。 --soname でライブラリ名も真似しておく
4. ダミーでホンモノを置き換える

たぶん objdump の出力を削る部分とかは、もっとうまいやり方があるはずだが、これで動く。

## 注意点

- 今どきのメモリは安い。今さら、こんな節約方法をするリスクの方が高いので、全くおすすめしない
